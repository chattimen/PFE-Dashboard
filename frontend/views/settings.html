<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paramètres - Dashboard de Sécurité</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/dark-mode.css">
    
    <!-- JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-logo">
                <img src="../assets/img/logo.png" alt="Logo Dashboard Sécurité">
                <h1>Dashboard de Sécurité</h1>
            </div>
            <ul class="navbar-nav">
                <li><a href="index.html" data-page="dashboard">Dashboard</a></li>
                <li><a href="trivy.html" data-page="trivy">Trivy</a></li>
                <li><a href="sonarqube.html" data-page="sonarqube">SonarQube</a></li>
                <li><a href="zap.html" data-page="zap">OWASP ZAP</a></li>
                <li><a href="selenium.html" data-page="selenium">Selenium</a></li>
                <li><a href="settings.html" class="active" data-page="settings">Paramètres</a></li>
                <li><button id="theme-toggle" class="btn btn-sm btn-secondary"><i class="fas fa-moon"></i></button></li>
            </ul>
        </div>
    </nav>
    
    <!-- Contenu principal -->
    <div class="container">
        <div class="page-header">
            <h2 class="page-title">Paramètres</h2>
        </div>
        
        <!-- Configuration générale -->
        <div class="card">
            <div class="card-header">Configuration générale</div>
            <div class="card-body">
                <div class="form-group">
                    <label class="form-label" for="theme-selector">Thème</label>
                    <select id="theme-selector" class="form-control">
                        <option value="light">Clair</option>
                        <option value="dark">Sombre</option>
                        <option value="auto">Automatique (selon système)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="refresh-interval">Intervalle de rafraîchissement (secondes)</label>
                    <input type="number" id="refresh-interval" class="form-control" min="0" value="300">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="default-period">Période par défaut</label>
                    <select id="default-period" class="form-control">
                        <option value="7">7 jours</option>
                        <option value="30" selected>30 jours</option>
                        <option value="90">90 jours</option>
                        <option value="180">6 mois</option>
                        <option value="365">1 an</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Format de date</label>
                    <div class="d-flex gap-1">
                        <div>
                            <input type="radio" id="date-format-1" name="date-format" value="DD/MM/YYYY" checked>
                            <label for="date-format-1">DD/MM/YYYY</label>
                        </div>
                        <div>
                            <input type="radio" id="date-format-2" name="date-format" value="MM/DD/YYYY">
                            <label for="date-format-2">MM/DD/YYYY</label>
                        </div>
                        <div>
                            <input type="radio" id="date-format-3" name="date-format" value="YYYY-MM-DD">
                            <label for="date-format-3">YYYY-MM-DD</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Configuration des outils -->
        <div class="card mt-2">
            <div class="card-header">Configuration des outils</div>
            <div class="card-body">
                <!-- Trivy -->
                <div class="form-group">
                    <h3>Trivy</h3>
                    <div class="d-flex align-center gap-1 mb-1">
                        <input type="checkbox" id="trivy-enabled" checked>
                        <label for="trivy-enabled">Activer Trivy</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="sonarqube-token">Token d'API SonarQube</label>
                        <input type="password" id="sonarqube-token" class="form-control" placeholder="••••••••••••••••">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="sonarqube-project-key">Clé du projet par défaut</label>
                        <input type="text" id="sonarqube-project-key" class="form-control" placeholder="my-project">
                    </div>
                </div>
                
                <!-- OWASP ZAP -->
                <div class="form-group">
                    <h3>OWASP ZAP</h3>
                    <div class="d-flex align-center gap-1 mb-1">
                        <input type="checkbox" id="zap-enabled" checked>
                        <label for="zap-enabled">Activer OWASP ZAP</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="zap-api-url">URL de l'API ZAP</label>
                        <input type="text" id="zap-api-url" class="form-control" value="http://localhost:8090">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="zap-api-key">Clé API ZAP</label>
                        <input type="password" id="zap-api-key" class="form-control" placeholder="••••••••••••••••">
                    </div>
                </div>
                
                <!-- Selenium -->
                <div class="form-group">
                    <h3>Selenium</h3>
                    <div class="d-flex align-center gap-1 mb-1">
                        <input type="checkbox" id="selenium-enabled" checked>
                        <label for="selenium-enabled">Activer Selenium</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="selenium-grid-url">URL du Hub Selenium</label>
                        <input type="text" id="selenium-grid-url" class="form-control" value="http://localhost:4444/wd/hub">
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <button id="save-settings" class="btn btn-primary">Enregistrer</button>
                <button id="reset-settings" class="btn btn-secondary">Réinitialiser</button>
            </div>
        </div>
        
        <!-- Intégration Azure DevOps -->
        <div class="card mt-2">
            <div class="card-header">Intégration Azure DevOps</div>
            <div class="card-body">
                <div class="form-group">
                    <div class="d-flex align-center gap-1 mb-1">
                        <input type="checkbox" id="azure-integration-enabled" checked>
                        <label for="azure-integration-enabled">Activer l'intégration Azure DevOps</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="azure-organization">Organisation</label>
                        <input type="text" id="azure-organization" class="form-control" placeholder="votre-organisation">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="azure-project">Projet</label>
                        <input type="text" id="azure-project" class="form-control" placeholder="votre-projet">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="azure-pat">Personal Access Token</label>
                        <input type="password" id="azure-pat" class="form-control" placeholder="••••••••••••••••">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="azure-pipeline-id">ID du Pipeline</label>
                        <input type="text" id="azure-pipeline-id" class="form-control" placeholder="123">
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <button id="test-azure-connection" class="btn btn-info">Tester la connexion</button>
                <button id="save-azure-settings" class="btn btn-primary">Enregistrer</button>
            </div>
        </div>
        
        <!-- Alertes et notifications -->
        <div class="card mt-2">
            <div class="card-header">Alertes et notifications</div>
            <div class="card-body">
                <div class="form-group">
                    <div class="d-flex align-center gap-1 mb-1">
                        <input type="checkbox" id="email-alerts-enabled">
                        <label for="email-alerts-enabled">Activer les alertes par email</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="email-recipients">Destinataires des emails (séparés par des virgules)</label>
                        <input type="text" id="email-recipients" class="form-control" placeholder="admin@example.com, security@example.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="d-flex align-center gap-1 mb-1">
                        <input type="checkbox" id="slack-alerts-enabled">
                        <label for="slack-alerts-enabled">Activer les alertes Slack</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="slack-webhook">URL Webhook Slack</label>
                        <input type="text" id="slack-webhook" class="form-control" placeholder="https://hooks.slack.com/services/...">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="slack-channel">Canal Slack</label>
                        <input type="text" id="slack-channel" class="form-control" placeholder="#security-alerts">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="critical-alert-threshold">Seuil d'alerte pour les vulnérabilités critiques</label>
                    <select id="critical-alert-threshold" class="form-control">
                        <option value="1">1 ou plus</option>
                        <option value="3" selected>3 ou plus</option>
                        <option value="5">5 ou plus</option>
                        <option value="10">10 ou plus</option>
                    </select>
                </div>
            </div>
            <div class="card-footer">
                <button id="test-notifications" class="btn btn-info">Tester les notifications</button>
                <button id="save-notification-settings" class="btn btn-primary">Enregistrer</button>
            </div>
        </div>
    </div>
    
    <!-- Conteneur pour les notifications -->
    <div id="notification-container"></div>
    
    <!-- JavaScript -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les paramètres actuels
            loadCurrentSettings();
            
            // Gestion du thème sombre/clair
            document.getElementById('theme-toggle').addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
                
                // Mettre à jour la sélection dans le formulaire
                const themeSelector = document.getElementById('theme-selector');
                themeSelector.value = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            });
            
            // Appliquer le thème selon les préférences
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-selector').value = 'dark';
            }
            
            // Changement du thème via le sélecteur
            document.getElementById('theme-selector').addEventListener('change', function() {
                const isDarkMode = this.value === 'dark' || (this.value === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);
                
                if (isDarkMode) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
                
                localStorage.setItem('darkMode', isDarkMode);
            });
            
            // Enregistrer les paramètres généraux
            document.getElementById('save-settings').addEventListener('click', function() {
                saveGeneralSettings();
                showNotification('Paramètres enregistrés avec succès', 'success');
            });
            
            // Réinitialiser les paramètres
            document.getElementById('reset-settings').addEventListener('click', function() {
                if (confirm('Êtes-vous sûr de vouloir réinitialiser tous les paramètres aux valeurs par défaut ?')) {
                    resetSettings();
                    showNotification('Paramètres réinitialisés aux valeurs par défaut', 'info');
                }
            });
            
            // Tester la connexion Azure DevOps
            document.getElementById('test-azure-connection').addEventListener('click', function() {
                testAzureConnection();
            });
            
            // Enregistrer les paramètres Azure DevOps
            document.getElementById('save-azure-settings').addEventListener('click', function() {
                saveAzureSettings();
                showNotification('Paramètres Azure DevOps enregistrés avec succès', 'success');
            });
            
            // Tester les notifications
            document.getElementById('test-notifications').addEventListener('click', function() {
                testNotifications();
            });
            
            // Enregistrer les paramètres de notification
            document.getElementById('save-notification-settings').addEventListener('click', function() {
                saveNotificationSettings();
                showNotification('Paramètres de notification enregistrés avec succès', 'success');
            });
        });
        
        // Fonction pour charger les paramètres actuels
        function loadCurrentSettings() {
            // Cette fonction chargerait normalement les paramètres depuis l'API
            // Pour l'instant, on utilise les valeurs stockées localement
            
            // Paramètres généraux
            document.getElementById('refresh-interval').value = localStorage.getItem('refreshInterval') || 300;
            document.getElementById('default-period').value = localStorage.getItem('defaultPeriod') || 30;
            
            const dateFormat = localStorage.getItem('dateFormat') || 'DD/MM/YYYY';
            document.querySelector(`input[name="date-format"][value="${dateFormat}"]`).checked = true;
            
            // Paramètres des outils
            document.getElementById('trivy-enabled').checked = localStorage.getItem('trivyEnabled') !== 'false';
            document.getElementById('trivy-severity-threshold').value = localStorage.getItem('trivySeverityThreshold') || 'high';
            
            document.getElementById('sonarqube-enabled').checked = localStorage.getItem('sonarqubeEnabled') !== 'false';
            document.getElementById('sonarqube-url').value = localStorage.getItem('sonarqubeUrl') || 'http://localhost:9000';
            
            document.getElementById('zap-enabled').checked = localStorage.getItem('zapEnabled') !== 'false';
            document.getElementById('zap-api-url').value = localStorage.getItem('zapApiUrl') || 'http://localhost:8090';
            
            document.getElementById('selenium-enabled').checked = localStorage.getItem('seleniumEnabled') !== 'false';
            document.getElementById('selenium-grid-url').value = localStorage.getItem('seleniumGridUrl') || 'http://localhost:4444/wd/hub';
            
            // Paramètres Azure DevOps
            document.getElementById('azure-integration-enabled').checked = localStorage.getItem('azureIntegrationEnabled') === 'true';
            document.getElementById('azure-organization').value = localStorage.getItem('azureOrganization') || '';
            document.getElementById('azure-project').value = localStorage.getItem('azureProject') || '';
            
            // Paramètres de notification
            document.getElementById('email-alerts-enabled').checked = localStorage.getItem('emailAlertsEnabled') === 'true';
            document.getElementById('email-recipients').value = localStorage.getItem('emailRecipients') || '';
            
            document.getElementById('slack-alerts-enabled').checked = localStorage.getItem('slackAlertsEnabled') === 'true';
            document.getElementById('slack-webhook').value = localStorage.getItem('slackWebhook') || '';
            document.getElementById('slack-channel').value = localStorage.getItem('slackChannel') || '#security-alerts';
            
            document.getElementById('critical-alert-threshold').value = localStorage.getItem('criticalAlertThreshold') || '3';
        }
        
        // Fonction pour enregistrer les paramètres généraux
        function saveGeneralSettings() {
            // Enregistrer les paramètres généraux en local storage
            localStorage.setItem('refreshInterval', document.getElementById('refresh-interval').value);
            localStorage.setItem('defaultPeriod', document.getElementById('default-period').value);
            localStorage.setItem('dateFormat', document.querySelector('input[name="date-format"]:checked').value);
            
            // Enregistrer les paramètres des outils
            localStorage.setItem('trivyEnabled', document.getElementById('trivy-enabled').checked);
            localStorage.setItem('trivySeverityThreshold', document.getElementById('trivy-severity-threshold').value);
            
            localStorage.setItem('sonarqubeEnabled', document.getElementById('sonarqube-enabled').checked);
            localStorage.setItem('sonarqubeUrl', document.getElementById('sonarqube-url').value);
            
            localStorage.setItem('zapEnabled', document.getElementById('zap-enabled').checked);
            localStorage.setItem('zapApiUrl', document.getElementById('zap-api-url').value);
            
            localStorage.setItem('seleniumEnabled', document.getElementById('selenium-enabled').checked);
            localStorage.setItem('seleniumGridUrl', document.getElementById('selenium-grid-url').value);
            
            // Dans une application réelle, ces paramètres seraient également sauvegardés via l'API
        }
        
        // Fonction pour réinitialiser les paramètres
        function resetSettings() {
            // Réinitialiser les valeurs des champs
            document.getElementById('refresh-interval').value = 300;
            document.getElementById('default-period').value = 30;
            document.querySelector('input[name="date-format"][value="DD/MM/YYYY"]').checked = true;
            
            document.getElementById('trivy-enabled').checked = true;
            document.getElementById('trivy-severity-threshold').value = 'high';
            
            document.getElementById('sonarqube-enabled').checked = true;
            document.getElementById('sonarqube-url').value = 'http://localhost:9000';
            document.getElementById('sonarqube-token').value = '';
            document.getElementById('sonarqube-project-key').value = '';
            
            document.getElementById('zap-enabled').checked = true;
            document.getElementById('zap-api-url').value = 'http://localhost:8090';
            document.getElementById('zap-api-key').value = '';
            
            document.getElementById('selenium-enabled').checked = true;
            document.getElementById('selenium-grid-url').value = 'http://localhost:4444/wd/hub';
            
            document.getElementById('azure-integration-enabled').checked = false;
            document.getElementById('azure-organization').value = '';
            document.getElementById('azure-project').value = '';
            document.getElementById('azure-pat').value = '';
            document.getElementById('azure-pipeline-id').value = '';
            
            document.getElementById('email-alerts-enabled').checked = false;
            document.getElementById('email-recipients').value = '';
            
            document.getElementById('slack-alerts-enabled').checked = false;
            document.getElementById('slack-webhook').value = '';
            document.getElementById('slack-channel').value = '#security-alerts';
            
            document.getElementById('critical-alert-threshold').value = '3';
            
            // Sauvegarder les valeurs par défaut
            saveGeneralSettings();
            saveAzureSettings();
            saveNotificationSettings();
        }
        
        // Fonction pour tester la connexion Azure DevOps
        function testAzureConnection() {
            const organization = document.getElementById('azure-organization').value;
            const project = document.getElementById('azure-project').value;
            const pat = document.getElementById('azure-pat').value;
            
            if (!organization || !project || !pat) {
                showNotification('Veuillez remplir tous les champs Azure DevOps', 'error');
                return;
            }
            
            // Simulation d'une requête API (à remplacer par une vraie requête dans l'application)
            setTimeout(() => {
                showNotification('Connexion à Azure DevOps réussie', 'success');
            }, 1000);
        }
        
        // Fonction pour enregistrer les paramètres Azure DevOps
        function saveAzureSettings() {
            localStorage.setItem('azureIntegrationEnabled', document.getElementById('azure-integration-enabled').checked);
            localStorage.setItem('azureOrganization', document.getElementById('azure-organization').value);
            localStorage.setItem('azureProject', document.getElementById('azure-project').value);
            localStorage.setItem('azurePipelineId', document.getElementById('azure-pipeline-id').value);
            
            // Ne pas stocker le PAT en local storage dans une vraie application
            // Il devrait être stocké de manière sécurisée côté serveur
        }
        
        // Fonction pour tester les notifications
        function testNotifications() {
            if (document.getElementById('email-alerts-enabled').checked) {
                const emailRecipients = document.getElementById('email-recipients').value;
                if (!emailRecipients) {
                    showNotification('Veuillez spécifier au moins un destinataire email', 'warning');
                } else {
                    showNotification('Email de test envoyé à ' + emailRecipients, 'success');
                }
            }
            
            if (document.getElementById('slack-alerts-enabled').checked) {
                const slackWebhook = document.getElementById('slack-webhook').value;
                const slackChannel = document.getElementById('slack-channel').value;
                if (!slackWebhook) {
                    showNotification('Veuillez spécifier l\'URL du webhook Slack', 'warning');
                } else {
                    showNotification('Message de test envoyé à ' + slackChannel, 'success');
                }
            }
            
            if (!document.getElementById('email-alerts-enabled').checked && !document.getElementById('slack-alerts-enabled').checked) {
                showNotification('Aucun système de notification n\'est activé', 'info');
            }
        }
        
        // Fonction pour enregistrer les paramètres de notification
        function saveNotificationSettings() {
            localStorage.setItem('emailAlertsEnabled', document.getElementById('email-alerts-enabled').checked);
            localStorage.setItem('emailRecipients', document.getElementById('email-recipients').value);
            
            localStorage.setItem('slackAlertsEnabled', document.getElementById('slack-alerts-enabled').checked);
            localStorage.setItem('slackWebhook', document.getElementById('slack-webhook').value);
            localStorage.setItem('slackChannel', document.getElementById('slack-channel').value);
            
            localStorage.setItem('criticalAlertThreshold', document.getElementById('critical-alert-threshold').value);
        }
        
        // Fonction pour afficher une notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span class="notification-message">${message}</span>
                <button class="notification-close">&times;</button>
            `;
            
            const container = document.getElementById('notification-container');
            container.appendChild(notification);
            
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', function() {
                notification.remove();
            });
            
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    notification.remove();
                }, 500);
            }, 5000);
        }
    </script>
</body>
</html>
                        <label class="form-label" for="trivy-severity-threshold">Seuil de sévérité pour les alertes</label>
                        <select id="trivy-severity-threshold" class="form-control">
                            <option value="critical">Critique uniquement</option>
                            <option value="high" selected>Élevée et Critique</option>
                            <option value="medium">Moyenne et supérieure</option>
                            <option value="low">Toutes les sévérités</option>
                        </select>
                    </div>
                </div>
                
                <!-- SonarQube -->
                <div class="form-group">
                    <h3>SonarQube</h3>
                    <div class="d-flex align-center gap-1 mb-1">
                        <input type="checkbox" id="sonarqube-enabled" checked>
                        <label for="sonarqube-enabled">Activer SonarQube</label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="sonarqube-url">URL SonarQube</label>
                        <input type="text" id="sonarqube-url" class="form-control" value="http://localhost:9000">
                    </div>
                    <div class="form-group">